"use strict";(self["webpackChunkframe"]=self["webpackChunkframe"]||[]).push([[3967],{33967:function(t,e,s){s.r(e),s.d(e,{default:function(){return kt}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container publish"},[e("home-header"),e("div",{staticClass:"mianCon"},[t.classroomInfo?e("div",{staticClass:"center"},[1===t.step?e("step-classroom-type",{ref:"step1",attrs:{"classroom-info":t.classroomInfo},on:{next:t.onNext}}):t._e(),2===t.step?e("step-classroom-area",{ref:"step2",attrs:{"classroom-info":t.classroomInfo},on:{next:t.onNext,prev:function(e){t.step--}}}):t._e(),3===t.step?e("step-classroom-location",{ref:"step3",attrs:{"classroom-info":t.classroomInfo},on:{next:t.onNext,prev:function(e){t.step--}}}):t._e(),4===t.step?e("step-classroom-picture",{ref:"step4",attrs:{"classroom-info":t.classroomInfo},on:{next:t.onNext,prev:function(e){t.step--}}}):t._e(),5===t.step?e("step-classroom-name",{ref:"step5",attrs:{"classroom-info":t.classroomInfo},on:{next:t.onNext,prev:function(e){t.step--}}}):t._e(),6===t.step?e("step-classroom-desc",{ref:"step6",attrs:{"classroom-info":t.classroomInfo},on:{next:t.onNext,prev:function(e){t.step--}}}):t._e(),7===t.step?e("step-classroom-tag",{ref:"step7",attrs:{"classroom-info":t.classroomInfo},on:{next:t.onNext,prev:function(e){t.step--}}}):t._e(),8===t.step?e("step-classroom-price",{ref:"step8",attrs:{"classroom-info":t.classroomInfo},on:{next:t.onNext,prev:function(e){t.step--}}}):t._e()],1):t._e()]),t.showRedirectDialog?e("redirect-dialog",{attrs:{id:t.id},model:{value:t.showRedirectDialog,callback:function(e){t.showRedirectDialog=e},expression:"showRedirectDialog"}}):t._e(),e("HomeFooter")],1)},i=[],o=s(68892),r=s(18031),l=s(51206),n=s(15936),c=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon1"},[e("title-view",{attrs:{title:t.$t("jsdClassroomPublish.enter_classroom_area"),"sub-title":t.$t("jsdClassroomPublish.qingshurumianji")}}),e("div",{staticClass:"stepMain"},[e("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"area_size",label:""}},[e("el-input",{staticClass:"xuekeSelect",attrs:{type:"text",maxlength:10,"show-word-limit":"",placeholder:t.$t("jsdClassroomPublish.qingshurumianji")},model:{value:t.formData.area_size,callback:function(e){t.$set(t.formData,"area_size",t._n(e))},expression:"formData.area_size"}},[e("div",{staticClass:"append",attrs:{slot:"append"},slot:"append"},[t._v(t._s(t.$t("jsdClassroomPublish.square_feet")))])])],1)],1)],1),e("buttons-view",{on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},m=[],d=s(40662),u=s(16016),p={name:"StepClassroomArea",components:{ButtonsView:u.Z,TitleView:d.Z},props:{classroomInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{area_size:this.classroomInfo.area_size||""},rules:{area_size:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}]}}},computed:{unitOptions(){return[{label:"平方米",value:"1"},{label:"平方英尺",value:"2"}]}},methods:{next(t){this.$refs.form.validate((e=>{e&&this.$emit("next",this.formData,t)}))}}},f=p,h=s(1001),g=(0,h.Z)(f,c,m,!1,null,"0b1b5871",null),b=g.exports,v=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon2"},[e("title-view",{attrs:{title:t.$t("jsdClassroomPublish.ningdejiaoshijiangweiyu"),"sub-title":t.$t("jsdClassroomPublish.zhiyouxueshengxiadanhou")}}),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"stepMain"},[e("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("div",{staticClass:"bot"},[e("el-form-item",{attrs:{prop:"area"}},[e("el-input",{staticClass:"addInp",attrs:{maxlength:200,type:"textarea",rows:"3","show-word-limit":"",placeholder:t.$t("LoginAndRegister.region_tips")},model:{value:t.formData.area,callback:function(e){t.$set(t.formData,"area",e)},expression:"formData.area"}})],1)],1),e("div",{staticClass:"bot"},[e("el-form-item",{attrs:{prop:"address"}},[e("el-input",{staticClass:"addInp",attrs:{maxlength:200,type:"textarea",rows:"3","show-word-limit":"",placeholder:t.$t("LoginAndRegister.address_tips")},model:{value:t.formData.address,callback:function(e){t.$set(t.formData,"address",e)},expression:"formData.address"}})],1)],1)])],1),e("buttons-view",{attrs:{disabled:t.loading},on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},x=[],C={name:"StepClassroomLocation",components:{ButtonsView:u.Z,TitleView:d.Z},props:{classroomInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{area:this.classroomInfo.area||"",address:this.classroomInfo.address||""},rules:{area:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}],address:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}]},countryOptions:[],loading:!1}},mounted(){},methods:{next(t){this.$refs.form.validate((e=>{if(e){let e={...this.formData};this.$emit("next",e,t)}}))}}},_=C,$=(0,h.Z)(_,v,x,!1,null,"701024ac",null),w=$.exports,D=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon3"},[e("title-view",{attrs:{title:t.$t("jsdClassroomPublish.weiningdejiaoshitianjiatupian"),"sub-title":t.$t("jsdClassroomPublish.nixuyaoxiantigongzhishao",[t.at_least])}}),e("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"images"}},[e("div",{staticClass:"stepMain"},[e("CustomElUpload",{ref:"customElUpload",attrs:{template_type:"picture-card",upload_tip_text:t.$t("tip.size_limit"),files_limit:10,add_param_data:"",autoUpload:!0},on:{isUploading:e=>t.uploading=e},model:{value:t.formData.images,callback:function(e){t.$set(t.formData,"images",e)},expression:"formData.images"}})],1)])],1),e("buttons-view",{attrs:{disabled:t.uploading},on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},y=[],j={name:"StepClassroomPicture",components:{ButtonsView:u.Z,TitleView:d.Z,CustomElUpload:n.Z},props:{classroomInfo:{type:Object,required:!0,default:()=>({})}},data(){const t=5;let e=(e,s,a)=>{!s||s.split(",").length<t?a(new Error):a()};return{formData:{images:this.classroomInfo.images||""},rules:{images:[{validator:e,message:this.$t("tip.at_least_upload_image",[t]),trigger:["change"]}]},uploading:!1,at_least:t}},methods:{next(t){this.$refs.form.validate((e=>{e&&this.$emit("next",this.formData,t)}))}}},I=j,k=(0,h.Z)(I,D,y,!1,null,"aec14982",null),q=k.exports,P=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon4"},[e("title-view",{attrs:{title:t.$t("jsdClassroomPublish.xianzaiqinggeijiaoshi"),"sub-title":t.$t("jsdClassroomPublish.duanmingxiaoguo")}}),e("div",{staticClass:"stepMain"},[e("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"name",label:""}},[e("el-input",{staticClass:"textarea",attrs:{placeholder:t.$t("jsdClassroomPublish.qingshuruningdekechengmc"),"show-word-limit":"",maxlength:50},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1)],1)],1),e("buttons-view",{on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},T=[],S={name:"StepClassroomName",components:{ButtonsView:u.Z,TitleView:d.Z},props:{classroomInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{name:this.classroomInfo.name||""},rules:{name:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}]}}},methods:{next(t){this.$refs.form.validate((e=>{e&&this.$emit("next",this.formData,t)}))}}},Z=S,V=(0,h.Z)(Z,P,T,!1,null,"19149654",null),O=V.exports,z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon5"},[e("title-view",{attrs:{title:t.$t("jsdClassroomPublish.changjianjiaoshimiaoshu"),"sub-title":t.$t("jsdClassroomPublish.jieshaoyixiajiaoshi")}}),e("div",{staticClass:"stepMain"},[e("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"brief",label:""}},[e("el-input",{staticClass:"textarea",attrs:{type:"textarea",placeholder:"","show-word-limit":"","show-word-limit":""},model:{value:t.formData.brief,callback:function(e){t.$set(t.formData,"brief",e)},expression:"formData.brief"}})],1)],1)],1),e("buttons-view",{on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},N=[],B={name:"StepClassroomDesc",components:{ButtonsView:u.Z,TitleView:d.Z},props:{classroomInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{brief:this.classroomInfo.brief||""},rules:{brief:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}]}}},methods:{next(t){this.$refs.form.validate((e=>{e&&this.$emit("next",this.formData,t)}))}}},R=B,M=(0,h.Z)(R,z,N,!1,null,"78fa9961",null),E=M.exports,L=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon6"},[e("title-view",{attrs:{title:t.$t("jsdClassroomPublish.jiaoshibiaoqian"),"sub-title":t.$t("jsdClassroomPublish.xuanzeshiheningjiaoshide")}}),e("div",{staticClass:"stepMain"},[e("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"tag1",label:""}},[e("el-select",{staticClass:"xuekeSelect",attrs:{filterable:"","allow-create":"","no-data-text":"",placeholder:t.$t("jsdClassroomPublish.qingxuanzebiaoqian1")},model:{value:t.formData.tag1,callback:function(e){t.$set(t.formData,"tag1",e)},expression:"formData.tag1"}},t._l(t.classroomTagsOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name_arr,value:t.name_arr}})})),1)],1),e("el-form-item",{attrs:{prop:"tag2",label:""}},[e("el-select",{staticClass:"xuekeSelect",attrs:{filterable:"","allow-create":"","no-data-text":"",placeholder:t.$t("jsdClassroomPublish.qingxuanzebiaoqian2")},model:{value:t.formData.tag2,callback:function(e){t.$set(t.formData,"tag2",e)},expression:"formData.tag2"}},t._l(t.classroomTagsOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name_arr,value:t.name_arr}})})),1)],1),e("el-form-item",{attrs:{prop:"tag3",label:""}},[e("el-select",{staticClass:"xuekeSelect",attrs:{filterable:"","allow-create":"","no-data-text":"",placeholder:t.$t("jsdClassroomPublish.qingxuanzebiaoqian3")},model:{value:t.formData.tag3,callback:function(e){t.$set(t.formData,"tag3",e)},expression:"formData.tag3"}},t._l(t.classroomTagsOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name_arr,value:t.name_arr}})})),1)],1)],1)],1),e("buttons-view",{attrs:{disabled:t.loading},on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},U=[],F={name:"StepClassroomTag",components:{ButtonsView:u.Z,TitleView:d.Z},props:{classroomInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{tag1:"",tag2:"",tag3:""},rules:{tag1:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}]},loading:!1,classroomTagsOptions:[]}},mounted(){this.getClassroomTagsList()},methods:{next(t){this.$refs.form.validate((e=>{if(e){let e=[this.formData.tag1,this.formData.tag2,this.formData.tag3].join(",");this.$emit("next",{label_names:e},t)}}))},async getClassroomTagsList(){this.loading=!0;try{const t=await(0,l.Knk)();if(200===t.code){this.classroomTagsOptions=t.data;let e=this.classroomInfo.label_names?.split(",")||[];this.formData.tag1=e[0],this.formData.tag2=e[1],this.formData.tag3=e[2]}}catch(t){console.error(t)}this.loading=!1}}},H=F,A=(0,h.Z)(H,L,U,!1,null,"386c584c",null),J=A.exports,K=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon11"},[e("title-view",{attrs:{title:t.$t("jsdClassroomPublish.xianzaiqingshezhijiage"),"sub-title":t.$t("tip.commission_tip",[this.commission])}}),e("div",{staticClass:"stepMain"},[e("div",{staticClass:"PriceSetupCon"},[e("div",{staticClass:"top"},[e("div",{staticClass:"left",on:{click:t.minus}},[e("i",{staticClass:"icon fa fa-minus"})]),e("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{staticClass:"eleformItem",attrs:{prop:"price",label:""}},[e("div",{staticClass:"midCon"},[e("el-input",{staticClass:"inp",attrs:{type:"number"},model:{value:t.formData.price,callback:function(e){t.$set(t.formData,"price",e)},expression:"formData.price"}},[e("template",{slot:"prepend"},[t._v("$")])],2)],1)])],1),e("div",{staticClass:"right",on:{click:t.plus}},[e("i",{staticClass:"icon fa fa-plus"})])],1)])]),e("buttons-view",{attrs:{"next-text":t.$t("tip.completed")},on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},W=[],X=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"title"},[t._v(" "+t._s(t.title)+" ")]),e("div",{staticClass:"subTitle"},[t._v(" "+t._s(t.subTitle)+" ")])])},G=[],Q={name:"TitleView",props:["title","subTitle"]},Y=Q,tt=(0,h.Z)(Y,X,G,!1,null,"29747330",null),et=tt.exports,st=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"btnBox"},[t.showPrev?e("el-button",{staticClass:"btn",attrs:{disabled:t.disabled,type:"primary"},on:{click:function(e){return t.$emit("prev")}}},[t._v(t._s(t.prevText?t.prevText:this.$t("jsdClassroomPublish.shangyibu")))]):t._e(),t.showNext?e("el-button",{staticClass:"btn",attrs:{disabled:t.disabled,type:"primary"},on:{click:function(e){return t.$emit("next")}}},[t._v(t._s(t.nextText?t.nextText:this.$t("jsdClassroomPublish.xiayibu")))]):t._e()],1),e("el-button",{staticClass:"save-btn",attrs:{type:"primary",plain:""},on:{click:function(e){return t.$emit("next",!0)}}},[t._v(t._s(t.$t("jsdClassroomPublish.baocunbingtuichu")))])],1)},at=[],it={name:"ButtonsView",props:{showPrev:{type:Boolean,default:!0},showNext:{type:Boolean,default:!0},prevText:{type:String,default:""},nextText:{type:String,default:""},disabled:{type:Boolean,default:!1}}},ot=it,rt=(0,h.Z)(ot,st,at,!1,null,"95924c80",null),lt=rt.exports,nt={name:"StepClassroomPrice",components:{ButtonsView:lt,TitleView:et},props:{classroomInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{price:this.classroomInfo.price?parseFloat(this.classroomInfo.price):""},rules:{price:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}]},commission:10}},watch:{"formData.price"(t){t.length>16?this.$nextTick((()=>{this.formData.price=this.formData.price.slice(0,16)})):t<0&&this.$nextTick((()=>{this.formData.price=0}))}},methods:{next(t){this.$refs.form.validate((e=>{e&&this.$emit("next",this.formData,t)}))},minus(){this.formData.price--},plus(){this.formData.price++}}},ct=nt,mt=(0,h.Z)(ct,K,W,!1,null,"556c71f0",null),dt=mt.exports,ut=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon0"},[e("title-view",{attrs:{title:t.$t("jsdClassroomPublish.xiaincongjiben"),"sub-title":t.$t("jsdClassroomPublish.select_classroom_type")}}),e("div",{staticClass:"stepMain"},[e("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"type"}},[e("el-select",{staticClass:"xuekeSelect",attrs:{filterable:"","allow-create":"","no-data-text":"",placeholder:t.$t("tip.please_enter")},model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}},t._l(t.typeOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name_arr,value:t.name_arr}})})),1)],1)],1)],1),e("buttons-view",{attrs:{"show-prev":!1,disabled:t.loading},on:{next:t.next}})],1)},pt=[],ft={name:"StepClassroomType",components:{TitleView:et,ButtonsView:lt},props:{classroomInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{type:""},rules:{type:[{required:!0,message:this.$t("tip.required"),trigger:"change"}]},typeOptions:[],loading:!1}},mounted(){this.getTypeOptions()},methods:{async getTypeOptions(){this.loading=!0;try{const t=await(0,l.vy_)();200===t.code&&(this.typeOptions=t.data,this.formData.type=this.classroomInfo.type?.toString()||"")}catch(t){console.error(t)}this.loading=!1},next(t){this.$refs.form.validate((e=>{e&&this.$emit("next",this.formData,t)}))}}},ht=ft,gt=(0,h.Z)(ht,ut,pt,!1,null,"7697195d",null),bt=gt.exports,vt=s(70794),xt=function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"dialog",attrs:{title:t.$t("jsdClassroomPublish.creation_complete"),visible:t.dialogVisible,width:"400px","show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1,center:""},on:{"update:visible":function(e){t.dialogVisible=e},close:()=>t.$emit("input",!1)}},[e("div",{staticClass:"container"},[e("ul",{staticClass:"content"},[e("li",{on:{click:function(e){t.$router.replace("/classroom/publish?ts="+Date.now())}}},[t._v(t._s(t.$t("jsdClassroomPublish.continue_to_create"))),e("i",{staticClass:"el-icon-arrow-right"})]),e("li",{on:{click:function(e){return t.$router.replace("/ClassroomEdit?id="+t.id)}}},[t._v(t._s(t.$t("jsdClassroomPublish.setup_time"))),e("i",{staticClass:"el-icon-arrow-right"})]),e("li",{on:{click:function(e){return t.$router.back()}}},[t._v(t._s(t.$t("jsdClassroomPublish.back_to_list"))),e("i",{staticClass:"el-icon-arrow-right"})])])])])},Ct=[],_t={name:"RedirectDialog",props:["value","id"],data(){return{dialogVisible:!1}},created(){this.dialogVisible=this.value},watch:{value(t){this.dialogVisible=t}}},$t=_t,wt=(0,h.Z)($t,xt,Ct,!1,null,"03289b55",null),Dt=wt.exports,yt={name:"ClassroomPublish",components:{RedirectDialog:Dt,StepClassroomType:bt,StepClassroomPrice:dt,StepClassroomTag:J,StepClassroomDesc:E,StepClassroomName:O,StepClassroomPicture:q,StepClassroomLocation:w,StepClassroomArea:b,HomeHeader:o.Z,HomeFooter:r.Z,CustomElUpload:n.Z},data(){return{classroomInfo:null,step:1,totalStep:8,pageDetail:{},isFabuEdit:!1,id:"",draftId:"",submitting:!1,showRedirectDialog:!1}},mounted(){this.id=this.$route.params.id,this.draftId=this.$route.query.draft,this.init()},methods:{init(){this.id?this.getClassroomInfo():(this.classroomInfo={},this.draftId&&this.getDraft(this.draftId))},async getClassroomInfo(){try{const t=await(0,l.j5V)({id:this.id});200===t.code&&(this.classroomInfo={type:t.data.type_text,area_size:t.data.area_size,name:t.data.name,images:t.data.images,area:t.data.area,address:t.data.address,brief:t.data.brief,label_names:t.data.label_text?.join(","),price:t.data.price})}catch(t){console.error(t)}},onNext(t,e){this.classroomInfo={...this.classroomInfo,...t},console.log(this.classroomInfo),e?this.saveToDraft():this.step<this.totalStep?this.step++:this.onComplete()},async onComplete(){this.submitting=!0;try{this.id?await this.editClassroom():this.id=await this.addClassroom(),this.showRedirectDialog=!0}catch(t){console.error(t)}this.submitting=!1,this.draftId&&this.deleteDraft(this.draftId)},async deleteDraft(t){try{await(0,l.R56)(t)}catch(e){console.error(e)}},async saveToDraft(){this.submitting=!0;try{const t=JSON.stringify({step:this.step,progress:(0,vt.Z)(this.step).div(this.totalStep).times(100).toFixed(0),name:Date.now(),info:this.classroomInfo}),e=await(this.draftId?(0,l.XDd)(this.draftId,2,t):(0,l.uNc)(2,t));200===e.code&&this.$router.back()}catch(t){console.error(t)}this.submitting=!1},async getDraft(t){const e=this.$loading();try{const e=await(0,l.eJq)(t);if(200===e.code){const t=e.data?.json;t&&(this.step=t.step,this.classroomInfo=t.info)}}catch(s){console.error(s)}e.close()},async addClassroom(){const t=await(0,l._IS)(this.classroomInfo);return 200===t.code?(this.$message.success(t.msg),t.data.classroom_id):Promise.reject(t.code)},async editClassroom(){const t=await(0,l.$HW)({...this.classroomInfo,id:this.id});return 200===t.code?(this.$message.success(t.msg),this.id):Promise.reject(t.code)}}},jt=yt,It=(0,h.Z)(jt,a,i,!1,null,"5af496e1",null),kt=It.exports}}]);