"use strict";(self["webpackChunkframe"]=self["webpackChunkframe"]||[]).push([[225],{3225:function(e,t,s){s.r(t),s.d(t,{default:function(){return B}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("HomeHeader",{attrs:{topimgIsShow:!1}}),t("div",{staticClass:"center"},[t("div",{staticClass:"layoutLeft"},[t("class-calendar",{ref:"weekCalendar",on:{onSelectedUpdate:e.onClassSelectedChanged}})],1),t("div",{staticClass:"layoutRight"},[t("el-tabs",{model:{value:e.currentTabName,callback:function(t){e.currentTabName=t},expression:"currentTabName"}},[t("el-tab-pane",{attrs:{label:"设置",name:"0"}},[t("courses",{attrs:{selectedClassInfo:e.selectedClassInfo},on:{onCourseDelete:e.onCourseDelete,saveSuccess:e.onCourseSaveSuccess}})],1),t("el-tab-pane",{attrs:{label:"定价",name:"1"}},[t("prices",{attrs:{selectedClassInfo:e.selectedClassInfo},on:{saveSuccess:e.onPriceSaveSuccess}})],1),t("el-tab-pane",{attrs:{label:"学生名单",name:"2"}},[t("students",{attrs:{selectedClassInfo:e.selectedClassInfo}})],1),t("el-tab-pane",{attrs:{label:"预定教室",name:"3"}},[t("classrooms",{attrs:{selectedClassInfo:e.selectedClassInfo}})],1)],1)],1)])],1)},i=[],n=s(528),l=s(9869),o=function(){var e=this,t=e._self._c;return t("div",[e._m(0),t("div",{staticClass:"priceBox"},[t("div",[e._v("每小时")]),t("div",{staticClass:"num"},[t("span",[e._v("$")]),t("el-input",{attrs:{clearable:!0},model:{value:e.price,callback:function(t){e.price=t},expression:"price"}}),t("span",[e._v("USD")])],1)]),t("div",{staticClass:"discount"},[t("div",{staticClass:"title"},[e._v("折扣")]),t("div",{staticClass:"tips"},[e._v("调整当前时间课程价格，以吸引更多学生")]),e._l(e.discountList,(function(s,a){return t("div",{key:s.id,staticClass:"item",class:e.selectedDiscount?.id===s.id?"selected":"",on:{click:function(t){return e.selected(s)}}},[t("div",[e._v(e._s(s.name))]),t("div",{staticClass:"flex"},[t("div",{staticClass:"num"},[e._v(e._s(s.discount)+"%")]),t("div",{staticClass:"tipRht"},[e._v("折扣后的价格为$"+e._s(s.price)+"USD")])])])})),t("div",{staticClass:"addBtn",on:{click:e.addDiscount}},[t("span",[e._v("添加更多折扣")]),t("i",{staticClass:"el-icon-arrow-right"})]),t("el-button",{attrs:{type:"primary",disabled:e.submitDisabled,loading:e.saving},on:{click:e.save}},[e._v("保存")])],2),t("el-dialog",{attrs:{title:"新折扣",visible:e.showNewDiscount,width:"500px"},on:{"update:visible":function(t){e.showNewDiscount=t}}},[t("div",[t("el-form",{ref:"form",attrs:{model:e.addDiscountForm,rules:e.rules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"折扣名称",prop:"name"}},[t("el-input",{model:{value:e.addDiscountForm.name,callback:function(t){e.$set(e.addDiscountForm,"name",t)},expression:"addDiscountForm.name"}})],1),t("el-form-item",{attrs:{label:"折扣比例",prop:"discount"}},[t("el-input",{model:{value:e.addDiscountForm.discount,callback:function(t){e.$set(e.addDiscountForm,"discount",t)},expression:"addDiscountForm.discount"}},[t("template",{slot:"append"},[e._v("%")])],2)],1),t("el-form-item",[t("el-button",{on:{click:function(t){e.showNewDiscount=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.onAddSubmit}},[e._v("确 定")])],1)],1)],1)])],1)},c=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"flex mb20"},[t("div",[e._v("价格")]),t("div",[e._v("USD")])])}],r=s(1206),d=s(794),u={name:"Prices",props:{selectedClassInfo:{type:Object,default:()=>{}}},data(){return{addDiscountForm:{name:"",discount:""},rules:{name:[{required:!0,message:"请输入折扣名称",trigger:"blur"}],discount:[{required:!0,message:"请输入折扣比例",trigger:"blur"}]},price:"",showNewDiscount:!1,discounts:[],selectedDiscount:null,saving:!1}},watch:{selectedClass(e){1===e.length?(this.price=e[0].price,this.selectedDiscount=this.discountList.find((t=>t.id===e[0].discount_id))):(this.price="",this.selectedDiscount=null)}},computed:{submitDisabled(){return this.selectedClass.length<=0||!this.selectedDiscount||!this.price||(0,d.Z)(this.price).lte(0)},selectedClass(){return this.selectedClassInfo?.courses||[]},discountList(){return this.discounts.map((e=>({price:this.price?(0,d.Z)(this.price).multipliedBy(1-(0,d.Z)(e.discount).div(100)).decimalPlaces(2):0,...e})))}},mounted(){this.getDiscountList()},methods:{selected(e){this.selectedDiscount=e},async save(){this.saving=!0;try{let e=this.selectedClass.map((e=>e.id)).join(",");const t=await(0,r.z6)(this.selectedClassInfo.course_date_id,e,this.price,this.selectedDiscount.id);200===t.code&&(this.$message.success(this.$t("jsdCourseList.shezhichenggong")),this.$emit("saveSuccess"))}catch(e){console.error(e)}finally{this.saving=!1}},async getDiscountList(){try{const e=await(0,r.eE)();200===e.code&&(this.discounts=e.data)}catch(e){console.error(e)}},addDiscount(){this.addDiscountForm.name="",this.addDiscountForm.discount="",this.showNewDiscount=!0},async onAddSubmit(){try{await this.$refs["form"].validate();const e=await(0,r.ck)(this.addDiscountForm);200===e.code&&(this.showNewDiscount=!1,this.getDiscountList())}catch(e){console.error(e)}}}},m=u,h=s(1001),p=(0,h.Z)(m,o,c,!1,null,"6e99cea9",null),C=p.exports,v=function(){var e=this,t=e._self._c;return t("div",[t("el-select",{attrs:{editable:!1}}),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.studentList}},[t("el-table-column",{attrs:{label:"头像",width:"50"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("img",{staticClass:"avatar",attrs:{src:e.row.avatar}})]}}])}),t("el-table-column",{attrs:{prop:"username",label:"姓名",width:"80"}}),t("el-table-column",{attrs:{label:"课程时间"},scopedSlots:e._u([{key:"default",fn:function({row:{date:s,start_time:a,end_time:i}}){return[t("span",[e._v(e._s(s)+" "+e._s(a)+"-"+e._s(i))])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"50"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleClick(s.row)}}},[e._v("取消")])]}}])})],1),t("el-pagination",{attrs:{background:"","current-page":e.page,"page-size":e.pageSize,"pager-count":5,layout:"prev, pager, next",total:e.total},on:{"current-change":e.onPageChange,"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t}}})],1)},_=[],f={name:"Students",props:{selectedClassInfo:{type:Object,default:()=>{}}},data(){return{studentList:[],total:0,pageSize:20,page:1,id:""}},computed:{selectedClass(){return this.selectedClassInfo?.courses||[]}},watch:{selectedClass(e){e&&e.length?this.getStudents(1):(this.studentList=[],this.total=0)}},mounted(){this.id=this.$route.query.id,this.getDateList()},methods:{async getDateList(){try{let e=this.selectedClass.map((e=>e.id)).join(",");const t=await(0,r.yZ)(e);console.log(t)}catch(e){console.error(e)}},async getStudents(e){console.log(e);try{this.studentList=[],this.total=0;let t=this.selectedClass.map((e=>e.id)).join(",");const s=await(0,r.mr)(t,"",e,this.pageSize);200===s.code&&(this.studentList=s.data?.list,this.total=s.data?.total,this.page=e)}catch(t){console.error(t)}},onPageChange(e){this.getStudents(e)}}},b=f,g=(0,h.Z)(b,v,_,!1,null,"4ae5d074",null),k=g.exports,y=function(){var e=this,t=e._self._c;return t("div",[t("el-select",{attrs:{editable:!1}}),t("div",e._l(e.classroomList,(function(s){return t("div",{staticClass:"lineBox"},[t("div",{staticClass:"liBox"},[t("img",{staticClass:"imgBox",attrs:{src:s.images[0]??""}}),t("div",{staticClass:"right"},[t("div",{staticClass:"titleTop"},[e._v(e._s(s.name))]),t("div",[e._v(e._s(s.brief))])])]),t("div",[t("div",[e._v(e._s(s.address))]),t("div",{staticClass:"btnRht"},[t("el-button",{attrs:{type:"text"}},[e._v("预定")])],1)])])})),0)],1)},w=[],D={name:"Classrooms",props:{selectedClassInfo:{type:Object,default:()=>{}}},data(){return{classroomList:[]}},computed:{selectedClass(){return this.selectedClassInfo?.courses||[]}},watch:{selectedClass(e){e&&e.length?this.getClassRooms():this.classroomList=[]}},methods:{async getClassRooms(){try{this.classroomList=[];let e=this.selectedClass.map((e=>e.id)).join(",");const t=await(0,r.$Y)(e,1,20);200===t.code&&(this.classroomList=t.data.map((e=>({...e,images:e.images.split(",")}))))}catch(e){console.error(e)}}}},x=D,S=(0,h.Z)(x,y,w,!1,null,"0655725b",null),$=S.exports,I=function(){var e=this,t=e._self._c;return t("div",[t("dl",[t("dt",[e._v("上课时间")]),e._l(e.selectedClass,(function(s,a){return t("dd",{key:Math.random(),staticClass:"flexLine"},[t("div",[e._v(e._s(`${e.weekDay[parseInt(s.week)-1]} ${s.start_time} - ${s.end_time}`))]),t("div",{staticClass:"flex"},[t("div",{staticClass:"time"},[e._v(e._s(e.formatTimeLong(s.start_time,s.end_time)))]),t("el-popconfirm",{attrs:{title:"确定移除该课节么？"},on:{confirm:function(t){return e.remove(s.id)}}},[t("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[e._v("移除")])],1)],1)])}))],2),t("dl",[t("dt",[e._v("上课人数")]),t("dd",[t("el-input",{attrs:{clearable:!0},model:{value:e.book_num,callback:function(t){e.book_num=t},expression:"book_num"}})],1)]),t("dl",[e._m(0),t("dd",[t("el-input",{attrs:{clearable:!0},model:{value:e.book_min_num,callback:function(t){e.book_min_num=t},expression:"book_min_num"}})],1)]),t("dl",[t("dt",[e._v("上课地点")]),t("dd",[t("el-input",{attrs:{type:"textarea",clearable:!0,autosize:{minRows:2,maxRows:4}},model:{value:e.address,callback:function(t){e.address=t},expression:"address"}})],1)]),t("el-button",{attrs:{type:"primary",disabled:e.submitDisabled,loading:e.saving},on:{click:e.save}},[e._v("保存")])],1)},L=[function(){var e=this,t=e._self._c;return t("dt",[e._v("最低开课人数 "),t("span",{staticClass:"tips"},[e._v("(未达标课节自动取消)")])])}],q={name:"Courses",props:{selectedClassInfo:{type:Object,default:()=>{}}},data(){return{book_num:"",book_min_num:"",address:"",saving:!1}},watch:{selectedClass(e){1===e.length?(this.book_num=e[0].book_num,this.book_min_num=e[0].book_min_num,this.address=e[0].address):(this.book_num="",this.book_min_num="",this.address="")}},computed:{submitDisabled(){return this.selectedClass.length<=0||!this.book_num||!this.book_min_num||!this.address},selectedClass(){return this.selectedClassInfo?.courses||[]},weekDay(){return[this.$t("CourseCalendar.xingqi1"),this.$t("CourseCalendar.xingqi2"),this.$t("CourseCalendar.xingqi3"),this.$t("CourseCalendar.xingqi4"),this.$t("CourseCalendar.xingqi5"),this.$t("CourseCalendar.xingqi6"),this.$t("CourseCalendar.xingqi7")]}},methods:{async save(){try{this.saving=!0;let e=this.selectedClass.map((e=>e.id)).join(",");const t=await(0,r.uz)(this.selectedClassInfo.course_date_id,e,this.address,this.book_num,this.book_min_num);200===t.code&&(this.$message.success(this.$t("jsdCourseList.shezhichenggong")),this.$emit("saveSuccess"))}catch(e){console.error(e)}finally{this.saving=!1}},formatTimeLong(e,t){let s=e.split(":"),a=t.split(":"),i=60*parseInt(a[0])+parseInt(a[1])-(60*parseInt(s[0])+parseInt(s[1]));return this.$t("CourseCalendar.time_long_pattern",[i])},async remove(e){console.log(e);try{this.$emit("onCourseDelete",e)}catch(t){console.log()}}}},j=q,z=(0,h.Z)(j,I,L,!1,null,"95033b84",null),F=z.exports,Z={name:"headercom",components:{Courses:F,Classrooms:$,Students:k,Prices:C,ClassCalendar:l.Z,HomeHeader:n.Z},data(){return{selectedClassInfo:null,currentTabName:0}},watch:{},created(){},methods:{onClassSelectedChanged(e){console.log(e),this.selectedClassInfo=e},onCourseDelete(e){this.$refs.weekCalendar.unselectClassById(e)},onPriceSaveSuccess(){this.$refs.weekCalendar.queryCourses()},onCourseSaveSuccess(){this.$refs.weekCalendar.queryCourses()}}},N=Z,P=(0,h.Z)(N,a,i,!1,null,"080bf301",null),B=P.exports}}]);