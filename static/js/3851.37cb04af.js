"use strict";(self["webpackChunkframe"]=self["webpackChunkframe"]||[]).push([[3851],{63851:function(t,e,s){s.r(e),s.d(e,{default:function(){return Mt}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container publish"},[e("home-header"),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.submitting,expression:"submitting"}],staticClass:"mianCon"},[t.courseInfo?e("div",{staticClass:"center"},[e(t.currentComponent,{tag:"component",attrs:{"course-info":t.courseInfo},on:{next:t.onNext,prev:function(e){t.step--}}})],1):t._e()]),t.showRedirectDialog?e("redirect-dialog",{attrs:{id:t.id},model:{value:t.showRedirectDialog,callback:function(e){t.showRedirectDialog=e},expression:"showRedirectDialog"}}):t._e(),e("HomeFooter")],1)},i=[],r=s(51009),o=s(15936),n=s(51206),l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon1"},[e("title-view",{attrs:{title:t.$t("jsdCoursePublish.qingshuruxueke")}}),e("div",{staticClass:"stepMain"},[e("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"subject_name"}},[e("el-select",{staticClass:"xuekeSelect",attrs:{filterable:"","allow-create":"","no-data-text":"",placeholder:t.$t("tip.please_enter")},model:{value:t.formData.subject_name,callback:function(e){t.$set(t.formData,"subject_name",e)},expression:"formData.subject_name"}},t._l(t.subjectOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name_arr,value:t.name_arr}})})),1)],1)],1)],1),e("buttons-view",{attrs:{disabled:t.loading},on:{next:t.next,prev:function(e){return t.$emit("prev")}}})],1)},u=[],c=s(40662),m=s(16016),d={name:"StepSubject",components:{ButtonsView:m.Z,TitleView:c.Z},props:{courseInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{subject_name:""},rules:{subject_name:[{required:!0,message:this.$t("tip.required"),trigger:"blur"}]},subjectOptions:[],loading:!1}},mounted(){this.formData.subject_name=this.courseInfo.subject_name?.toString()||"",this.getSubjectOptions()},methods:{async getSubjectOptions(){this.loading=!0;try{const t=await(0,n.Lfi)();200===t.code&&(this.subjectOptions=t.data,this.formData.subject_name=this.courseInfo.subject_name?.toString()||"")}catch(t){console.error(t)}this.loading=!1},next(t){this.$refs.form.validate((e=>{e&&this.$emit("next",this.formData,t)}))}}},p=d,h=s(1001),f=(0,h.Z)(p,l,u,!1,null,"74a0b547",null),g=f.exports,b=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon2"},[e("title-view",{attrs:{title:t.$t("jsdCoursePublish.ningdejiaoshijiangweiyu"),"sub-title":""}}),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"stepMain"},[e("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"area"}},[e("el-input",{staticClass:"addInp",attrs:{maxlength:200,type:"textarea",rows:"3","show-word-limit":"",placeholder:t.$t("LoginAndRegister.region_tips")},model:{value:t.formData.area,callback:function(e){t.$set(t.formData,"area",e)},expression:"formData.area"}})],1)],1)],1),e("buttons-view",{attrs:{disabled:t.loading},on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},_=[],v={name:"StepLocation",components:{ButtonsView:m.Z,TitleView:c.Z},props:{courseInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{area:"",postal_code:""},rules:{area:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}]},countryOptions:[],loading:!1}},mounted(){this.formData.area=this.courseInfo?.area||"",this.formData.postal_code=this.courseInfo?.postal_code||""},methods:{async getAreaList(){this.loading=!0;try{const t=await(0,n.TVX)();200===t.code&&(this.countryOptions=this.dataConverter(t.data))}catch(t){console.error(t)}this.loading=!1},dataConverter(t){for(let e of t){e.children=e.city;for(let t of e.children)t.children=t.area}return t},prev(){this.$emit("prev")},next(t){this.$refs.form.validate((e=>{if(e){let e={...this.formData};this.$emit("next",e,t)}}))}}},C=v,x=(0,h.Z)(C,b,_,!1,null,"4d79d8b4",null),$=x.exports,D=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon3"},[e("title-view",{attrs:{title:t.$t("jsdCoursePublish.weiningdekechengtianjiatupian"),"sub-title":t.$t("jsdCoursePublish.nixuyaoxiantigongzhaopian",[this.at_least])}}),e("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"course_images"}},[e("div",{staticClass:"stepMain"},[e("CustomElUpload",{ref:"customElUpload1",attrs:{template_type:"picture-card",upload_tip_text:t.$t("tip.size_limit"),files_limit:10,add_param_data:"",autoUpload:!0},on:{isUploading:e=>{t.uploading=e}},model:{value:t.formData.course_images,callback:function(e){t.$set(t.formData,"course_images",e)},expression:"formData.course_images"}})],1)])],1),e("buttons-view",{attrs:{disabled:t.uploading},on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},w=[],y={name:"StepCoursePicture",components:{ButtonsView:m.Z,TitleView:c.Z,CustomElUpload:o.Z},props:{courseInfo:{type:Object,required:!0,default:()=>({})}},data(){const t=5;let e=(e,s,a)=>{console.log("value",s),!s||s.split(",").length<t?a(new Error):a()};return{formData:{course_images:""},rules:{course_images:[{validator:e,message:this.$t("tip.at_least_upload_image",[t]),trigger:["change"]}]},uploading:!1,at_least:t}},mounted(){this.formData.course_images=this.courseInfo?.course_images||""},methods:{next(t){this.$refs.form.validate((e=>{e&&this.$emit("next",this.formData,t)}))}}},j=y,k=(0,h.Z)(j,D,w,!1,null,"674ba8df",null),I=k.exports,q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon4"},[e("title-view",{attrs:{title:t.$t("jsdCoursePublish.huojianghuorenherongyu"),"sub-title":t.$t("jsdCoursePublish.ningyekeyixuanzebushangc")}}),e("el-form",{ref:"form",attrs:{model:t.formData}},[e("el-form-item",{attrs:{prop:"other_images"}},[e("div",{staticClass:"stepMain"},[e("CustomElUpload",{ref:"customElUpload2",attrs:{template_type:"picture-card",upload_tip_text:t.$t("tip.size_limit"),files_limit:10,add_param_data:"",autoUpload:!0},on:{isUploading:e=>t.uploading=e},model:{value:t.formData.other_images,callback:function(e){t.$set(t.formData,"other_images",e)},expression:"formData.other_images"}})],1)])],1),e("buttons-view",{attrs:{disabled:t.uploading},on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},P=[],Z={name:"StepHonorPicture",components:{ButtonsView:m.Z,TitleView:c.Z,CustomElUpload:o.Z},props:{courseInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{other_images:this.courseInfo?.other_images||""},uploading:!1}},methods:{next(t){this.$refs.form.validate((e=>{e&&this.$emit("next",this.formData,t)}))}}},S=Z,V=(0,h.Z)(S,q,P,!1,null,"230cde28",null),T=V.exports,O=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon5"},[e("title-view",{attrs:{title:t.$t("jsdCoursePublish.xianzaiqinggeinidekecheng"),"sub-title":t.$t("jsdCoursePublish.duanmingxiaoguo")}}),e("div",{staticClass:"stepMain"},[e("el-form",{ref:"ruleForm5",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"course_name",label:""}},[e("el-input",{staticClass:"inp",attrs:{type:"text",maxlength:50,"show-word-limit":"",placeholder:t.$t("jsdCoursePublish.qingshuruningdekechengmc")},model:{value:t.formData.course_name,callback:function(e){t.$set(t.formData,"course_name",e)},expression:"formData.course_name"}})],1),e("el-form-item",{attrs:{prop:"shortname"}},[e("el-input",{staticClass:"inp",attrs:{type:"text",maxlength:50,"show-word-limit":"",placeholder:t.$t("jsdCoursePublish.jiandanmingcheng")},model:{value:t.formData.shortname,callback:function(e){t.$set(t.formData,"shortname",e)},expression:"formData.shortname"}})],1)],1)],1),e("buttons-view",{on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},z=[],N={name:"StepCourseName",components:{ButtonsView:m.Z,TitleView:c.Z},props:{courseInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{course_name:this.courseInfo?.course_name||"",shortname:this.courseInfo?.shortname||""},rules:{course_name:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}]}}},methods:{next(t){this.$refs.ruleForm5.validate((e=>{e&&this.$emit("next",this.formData,t)}))}}},R=N,B=(0,h.Z)(R,O,z,!1,null,"e6f1cd52",null),M=B.exports,E=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon6"},[e("title-view",{attrs:{title:t.$t("jsdCoursePublish.changjiankechengmiaoshu"),"sub-title":t.$t("jsdCoursePublish.zhanshiningdekechengdute")}}),e("div",{staticClass:"stepMain"},[e("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"course_describe"}},[e("el-input",{staticClass:"textarea",attrs:{type:"textarea",placeholder:t.$t("jsdCoursePublish.qingshuruningdekechengms"),"show-word-limit":""},model:{value:t.formData.course_describe,callback:function(e){t.$set(t.formData,"course_describe",e)},expression:"formData.course_describe"}})],1)],1)],1),e("buttons-view",{on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},L=[],U={name:"StepCourseDesc",components:{ButtonsView:m.Z,TitleView:c.Z},props:{courseInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{course_describe:this.courseInfo.course_describe||""},rules:{course_describe:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}]}}},methods:{next(t){this.$refs.form.validate((e=>{e&&this.$emit("next",this.formData,t)}))}}},F=U,X=(0,h.Z)(F,E,L,!1,null,"8c9f1dc8",null),H=X.exports,A=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon7"},[e("title-view",{attrs:{title:t.$t("jsdCoursePublish.xuanzkechengdeshangk"),"sub-title":t.$t("jsdCoursePublish.xuanzeningdeshangke")}}),e("div",{staticClass:"stepMain"},[e("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"course_way"}},[e("div",{staticClass:"moshiCon"},[e("el-radio-group",{model:{value:t.formData.course_way,callback:function(e){t.$set(t.formData,"course_way",e)},expression:"formData.course_way"}},t._l(t.wayList,(function(s,a){return e("div",{key:s.id,staticClass:"item"},[e("el-radio",{staticClass:"leftRadio",attrs:{label:s.value,name:"shangkeFangshi"}}),e("div",{staticClass:"right"},[e("div",{staticClass:"title"},[t._v(" "+t._s(s.moshiName)+" ")]),e("div",{staticClass:"desc"},[t._v(" "+t._s(s.desc)+" ")])])],1)})),0)],1)])],1)],1),e("buttons-view",{attrs:{"show-prev":!1},on:{next:t.next}})],1)},J=[],W={name:"StepTeachingWay",components:{ButtonsView:m.Z,TitleView:c.Z},props:{courseInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{course_way:this.courseInfo.course_way},rules:{course_way:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}]}}},computed:{wayList(){return[{id:1,moshiName:this.$t("jsdCoursePublish.mianduimianshouke"),desc:this.$t("jsdCoursePublish.gongxiangjiaoshihuoxueshengjia"),value:"1",select:!1},{id:2,moshiName:this.$t("jsdCoursePublish.wangluoshipinshouke"),desc:this.$t("jsdCoursePublish.shiyonggerenshipinruanjian"),value:"2",select:!1}]}},methods:{next(t){this.$refs.form.validate((e=>{if(e){let e={course_way:this.formData.course_way};this.$emit("next",e,t)}}))}}},G=W,K=(0,h.Z)(G,A,J,!1,null,"7a3eca1b",null),Q=K.exports,Y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon8"},[e("title-view",{attrs:{title:t.$t("jsdCoursePublish.xuanzeshangkeleixing"),"sub-title":t.$t("jsdCoursePublish.zhanshiningdekechengdute")}}),e("div",{staticClass:"stepMain"},[e("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"course_type",label:""}},[e("div",{staticClass:"moshiCon"},t._l(t.typeList,(function(s,a){return e("div",{key:s.id,staticClass:"item"},[e("el-radio",{staticClass:"leftRadio",attrs:{label:s.value},model:{value:t.formData.course_type,callback:function(e){t.$set(t.formData,"course_type",e)},expression:"formData.course_type"}}),e("div",{staticClass:"right"},[e("div",{staticClass:"title"},[t._v(" "+t._s(s.name)+" ")]),e("div",{staticClass:"desc"},[t._v(" "+t._s(s.desc)+" ")])])],1)})),0)])],1)],1),e("buttons-view",{on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},tt=[],et={name:"StepCourseType",components:{ButtonsView:m.Z,TitleView:c.Z},props:{courseInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{course_type:this.courseInfo.course_type?.toString()||""},rules:{course_type:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}]}}},computed:{typeList(){return[{id:1,name:this.$t("jsdCoursePublish.k12xingquke"),desc:this.$t("jsdCoursePublish.shibasuiyixiaxuedexuexiao"),value:"1"},{id:2,name:this.$t("jsdCoursePublish.zuanqianjinengke"),desc:this.$t("jsdCoursePublish.chengnianrendejinenghexingquaihao"),value:"2"}]}},methods:{next(t){this.$refs.form.validate((e=>{e&&this.$emit("next",this.formData,t)}))}}},st=et,at=(0,h.Z)(st,Y,tt,!1,null,"c18e599c",null),it=at.exports,rt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon9"},[e("title-view",{attrs:{title:t.$t("jsdCoursePublish.kechengbiaoqian"),"sub-title":t.$t("jsdCoursePublish.xuanzeshiheningkechengde")}}),e("div",{staticClass:"stepMain"},[e("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"tag1",label:""}},[e("el-select",{staticClass:"bqSelect",attrs:{filterable:"","allow-create":"",placeholder:t.$t("jsdClassroomPublish.qingxuanzebiaoqian1")},model:{value:t.formData.tag1,callback:function(e){t.$set(t.formData,"tag1",e)},expression:"formData.tag1"}},t._l(t.courseTagsOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name_arr,value:t.name_arr}})})),1)],1),e("el-form-item",{attrs:{prop:"tag2"}},[e("el-select",{staticClass:"bqSelect",attrs:{filterable:"","allow-create":"",placeholder:t.$t("jsdClassroomPublish.qingxuanzebiaoqian2")},model:{value:t.formData.tag2,callback:function(e){t.$set(t.formData,"tag2",e)},expression:"formData.tag2"}},t._l(t.courseTagsOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name_arr,value:t.name_arr}})})),1)],1),e("el-form-item",{attrs:{prop:"tag3",label:""}},[e("el-select",{staticClass:"bqSelect",attrs:{filterable:"","allow-create":"",placeholder:t.$t("jsdClassroomPublish.qingxuanzebiaoqian3")},model:{value:t.formData.tag3,callback:function(e){t.$set(t.formData,"tag3",e)},expression:"formData.tag3"}},t._l(t.courseTagsOptions,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name_arr,value:t.name_arr}})})),1)],1)],1)],1),e("buttons-view",{attrs:{disabled:t.loading},on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},ot=[],nt={name:"StepCourseTags",components:{ButtonsView:m.Z,TitleView:c.Z},props:{courseInfo:{type:Object,required:!0,default:()=>({})}},data(){var t=(t,e,s)=>{e&&this.formData.tag1===e?s(new Error(this.$t("tip.option_duplicated"))):s()},e=(t,e,s)=>{!e||this.formData.tag1!==e&&this.formData.tag2!==e?s():s(new Error(this.$t("tip.option_duplicated")))};return{formData:{tag1:"",tag2:"",tag3:""},rules:{tag1:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}],tag2:[{validator:t,trigger:"blur",required:!1}],tag3:[{validator:e,trigger:"blur",required:!1}]},courseTagsOptions:[],loading:!1}},mounted(){this.getCourseTagsList()},methods:{next(t){this.$refs.form.validate((e=>{if(e){let e=[this.formData.tag1,this.formData.tag2,this.formData.tag3].join(",");this.$emit("next",{label_names:e},t)}}))},async getCourseTagsList(){this.loading=!0;try{const t=await(0,n.Iul)();if(200===t.code){this.courseTagsOptions=t.data;let e=this.courseInfo.label_names?.split(",")||[];this.formData.tag1=e[0],this.formData.tag2=e[1],this.formData.tag3=e[2]}}catch(t){console.error(t)}this.loading=!1}}},lt=nt,ut=(0,h.Z)(lt,rt,ot,!1,null,"998a13d8",null),ct=ut.exports,mt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon10"},[e("title-view",{attrs:{title:t.$t("jsdCoursePublish.course_video"),"sub-title":t.$t("jsdCoursePublish.paste_youtube_code")}}),e("div",{staticClass:"stepMain"},[e("el-form",{ref:"form",attrs:{model:t.formData}},[e("el-form-item",{attrs:{prop:"video"}},[e("el-input",{staticClass:"textarea",attrs:{type:"textarea",maxlength:200,"show-word-limit":"",rows:3,placeholder:"https://www.youtube.com/watch?v=xxXXxxXXXXX"},model:{value:t.formData.video,callback:function(e){t.$set(t.formData,"video",e)},expression:"formData.video"}})],1)],1)],1),e("buttons-view",{on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},dt=[],pt={name:"StepCourseVideo",components:{ButtonsView:m.Z,TitleView:c.Z},props:{courseInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{video:this.courseInfo.video||""}}},methods:{next(t){this.$emit("next",this.formData,t)}}},ht=pt,ft=(0,h.Z)(ht,mt,dt,!1,null,"5cc056db",null),gt=ft.exports,bt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon11"},[e("title-view",{attrs:{title:t.$t("jsdCoursePublish.xianzaiqingshezhijiage"),"sub-title":t.$t("tip.commission_tip",[this.commission])}}),e("div",{staticClass:"stepMain"},[e("div",{staticClass:"PriceSetupCon"},[e("div",{staticClass:"top"},[e("div",{staticClass:"left",on:{click:t.minus}},[e("i",{staticClass:"icon fa fa-minus"})]),e("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{staticClass:"eleformItem",attrs:{prop:"price",label:""}},[e("div",{staticClass:"midCon"},[e("el-input",{staticClass:"inp",attrs:{type:"number"},model:{value:t.formData.price,callback:function(e){t.$set(t.formData,"price",e)},expression:"formData.price"}},[e("template",{slot:"prepend"},[t._v("$")])],2)],1)])],1),e("div",{staticClass:"right",on:{click:t.plus}},[e("i",{staticClass:"icon fa fa-plus"})])],1)])]),e("buttons-view",{attrs:{"next-text":t.$t("tip.completed")},on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},_t=[],vt={name:"StepCoursePrice",components:{ButtonsView:m.Z,TitleView:c.Z},props:{courseInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{price:this.courseInfo.price?parseFloat(this.courseInfo.price):""},rules:{price:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]}]},commission:10}},watch:{"formData.price"(t){t.length>16?this.$nextTick((()=>{this.formData.price=this.formData.price.slice(0,16)})):t<0&&this.$nextTick((()=>{this.formData.price=0}))}},methods:{next(t){this.$refs.form.validate((e=>{e&&this.$emit("next",this.formData,t)}))},minus(){this.formData.price--},plus(){this.formData.price++}}},Ct=vt,xt=(0,h.Z)(Ct,bt,_t,!1,null,"62d06dd2",null),$t=xt.exports,Dt=s(18031),wt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"stepCon5"},[e("title-view",{attrs:{title:t.$t("jsdCoursePublish.setup_student_num"),"sub-title":""}}),e("div",{staticClass:"stepMain"},[e("el-form",{ref:"ruleForm5",attrs:{model:t.formData,rules:t.rules}},[e("el-form-item",{attrs:{prop:"book_num",label:""}},[e("el-input",{staticClass:"inp",attrs:{type:"text",maxlength:10,placeholder:t.$t("jsdCoursePublish.enter_student_num")},model:{value:t.formData.book_num,callback:function(e){t.$set(t.formData,"book_num",e)},expression:"formData.book_num"}})],1),e("el-form-item",{attrs:{prop:"book_min_num"}},[e("el-input",{staticClass:"inp",attrs:{type:"text",maxlength:10,placeholder:t.$t("jsdCoursePublish.enter_student_min_num")},model:{value:t.formData.book_min_num,callback:function(e){t.$set(t.formData,"book_min_num",e)},expression:"formData.book_min_num"}})],1)],1)],1),e("buttons-view",{attrs:{"next-text":t.$t("tip.completed")},on:{prev:function(e){return t.$emit("prev")},next:t.next}})],1)},yt=[],jt={name:"StepStudentNumber",components:{ButtonsView:m.Z,TitleView:c.Z},props:{courseInfo:{type:Object,required:!0,default:()=>({})}},data(){return{formData:{book_num:this.courseInfo?.book_num||"",book_min_num:this.courseInfo?.book_min_num||""},rules:{book_num:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]},{pattern:/^[1-9]\d*$/,message:this.$t("tip.format_incorrect"),trigger:"blur"}],book_min_num:[{required:!0,message:this.$t("tip.required"),trigger:["change","blur"]},{pattern:/^[1-9]\d*$/,message:this.$t("tip.format_incorrect"),trigger:"blur"}]}}},methods:{next(t){this.$refs.ruleForm5.validate((e=>{e&&this.$emit("next",this.formData,t)}))}}},kt=jt,It=(0,h.Z)(kt,wt,yt,!1,null,"4e85d034",null),qt=It.exports,Pt=function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"dialog",attrs:{title:t.$t("jsdCoursePublish.creation_complete"),visible:t.dialogVisible,width:"400px","show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1,center:""},on:{"update:visible":function(e){t.dialogVisible=e},close:()=>t.$emit("input",!1)}},[e("div",{staticClass:"container"},[e("ul",{staticClass:"content"},[e("li",{on:{click:function(e){t.$router.replace("/course/publish?ts="+Date.now())}}},[t._v(t._s(t.$t("jsdCoursePublish.continue_to_create"))),e("i",{staticClass:"el-icon-arrow-right"})]),e("li",{on:{click:function(e){return t.$router.replace("/jsdCourseEdit?id="+t.id)}}},[t._v(t._s(t.$t("jsdCoursePublish.setup_time"))),e("i",{staticClass:"el-icon-arrow-right"})]),e("li",{on:{click:function(e){return t.$router.back()}}},[t._v(t._s(t.$t("jsdCoursePublish.back_to_list"))),e("i",{staticClass:"el-icon-arrow-right"})])])])])},Zt=[],St={name:"RedirectDialog",props:["value","id"],data(){return{dialogVisible:!1}},created(){this.dialogVisible=this.value},watch:{value(t){this.dialogVisible=t}}},Vt=St,Tt=(0,h.Z)(Vt,Pt,Zt,!1,null,"cb0bca9c",null),Ot=Tt.exports,zt=s(70794),Nt={name:"CoursePublish",components:{RedirectDialog:Ot,StepStudentNumber:qt,HomeFooter:Dt.Z,StepCoursePrice:$t,StepCourseVideo:gt,StepCourseTags:ct,StepCourseType:it,StepTeachingWay:Q,StepCourseDesc:H,StepCourseName:M,StepHonorPicture:T,StepCoursePicture:I,StepLocation:$,StepSubject:g,HomeHeader:r.Z,CustomElUpload:o.Z},data(){return{pageDetail:null,step:1,courseInfo:null,id:"",submitting:!1,currentComponentRef:null,showRedirectDialog:!1,draftId:""}},computed:{components(){const t=["step-teaching-way","step-subject","step-location","step-course-picture","step-honor-picture","step-course-name","step-course-desc","step-course-type","step-course-tags","step-course-video","step-student-number"];return"2"===this.courseInfo?.course_way?t.filter((t=>"step-location"!==t)):t},currentComponent(){return this.components[this.step-1]}},mounted(){this.id=this.$route.params.id,this.draftId=this.$route.query.draft,this.init()},methods:{init(){this.id?this.getCourseInfo():this.draftId?this.getDraft(this.draftId):this.courseInfo={}},onNext(t,e){this.courseInfo={...this.courseInfo,...t},console.log(this.courseInfo),e?this.saveToDraft():this.step<this.components.length?this.step++:this.onComplete()},async onComplete(){this.submitting=!0;try{this.id?await this.editCourse():this.id=await this.createCourse(),this.draftId&&this.deleteDraft(this.draftId),this.showRedirectDialog=!0}catch(t){console.error(t)}this.submitting=!1},async deleteDraft(t){try{await(0,n.R56)(t)}catch(e){console.error(e)}},async saveToDraft(){this.submitting=!0;try{const t=JSON.stringify({step:this.step,progress:(0,zt.Z)(this.step).div(this.components.length).times(100).toFixed(0),name:Date.now(),info:this.courseInfo}),e=await(this.draftId?(0,n.XDd)(this.draftId,1,t):(0,n.uNc)(1,t));200===e.code&&this.$router.back()}catch(t){console.error(t)}this.submitting=!1},async getDraft(t){const e=this.$loading();try{const e=await(0,n.eJq)(t);if(200===e.code){const t=e.data?.json;t&&(this.courseInfo=t.info)}}catch(s){console.error(s)}this.courseInfo||(this.courseInfo={}),e.close()},async getCourseInfo(){const t=this.$loading();try{let t=await(0,n.RnH)({id:this.id});if(t&&200===t.code){let e=t.data,s={};s.subject_name=e.subject_text,s.area=e.area,s.address=e.address,s.course_images=e.course_images,s.other_images=e.other_images,s.course_name=e.name_arr,s.shortname=e.shortname_arr,s.course_describe=e.describe_text,s.course_way=e.course_way,s.course_type=e.course_type,s.label_names=e.course_label_text?.join(",")||"",s.video=e.video,s.book_num=e.book_num,s.book_min_num=e.book_min_num,s.price=e.price,this.courseInfo=s}}catch(e){console.error(e)}t.close()},async createCourse(){const t=await(0,n.bq0)(this.courseInfo);return 200===t.code?(this.$message.success(t.msg),t.data.course_id):Promise.reject(t.code)},async editCourse(){const t=await(0,n.Hfm)({...this.courseInfo,id:this.id});return 200===t.code?(this.$message.success(t.msg),this.id):Promise.reject(t.code)}}},Rt=Nt,Bt=(0,h.Z)(Rt,a,i,!1,null,"0837e4bb",null),Mt=Bt.exports}}]);