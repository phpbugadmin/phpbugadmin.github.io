"use strict";(self["webpackChunkframe"]=self["webpackChunkframe"]||[]).push([[6636],{96636:function(t,e,s){s.r(e),s.d(e,{default:function(){return q}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("HomeHeader",{attrs:{topimgIsShow:!1}}),e("div",{staticClass:"listCon mainContent"},[e("div",{staticClass:"center"},[e("div",{staticClass:"topTitle"},[t._v(" "+t._s(t.$t("jsdMyYuYueClassrooms.my_classroom_orders"))+" ")]),e("el-tabs",{staticClass:"tab-list",model:{value:t.currentTab,callback:function(e){t.currentTab=e},expression:"currentTab"}},t._l(t.tabList,(function(s){return e("el-tab-pane",{key:s.status,attrs:{name:s.name,status:s.status}},[e("template",{slot:"label"},[e("span",[t._v(t._s(s.lable))])])],2)})),1),t._l(t.tabList,(function(s){return e("div",{key:s.name},[t.currentTab===s.name?e("classroom-order-list",{attrs:{status:s.status}}):t._e()],1)}))],2)])],1)},l=[],i=(s(46229),s(17330),s(62062),s(63951)),o=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"table",staticStyle:{width:"100%"},attrs:{data:t.list}},[e("el-table-column",{attrs:{width:"100"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("img",{staticClass:"img",attrs:{src:s.classroom.images_text[0]},on:{click:function(e){return t.jumpDetail(s)}}})]}}])}),e("el-table-column",{attrs:{label:t.$t("jsdMyYuYueClassrooms.classroom_name"),"header-align":"center",align:"center"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("el-link",{staticClass:"name",on:{click:function(e){return t.toClassroom(s)}}},[t._v(t._s(s.classroom.name_arr))])]}}])}),e("el-table-column",{attrs:{label:t.$t("mycourse.course_time"),"header-align":"center",align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("el-popover",{attrs:{placement:"top-start",disabled:s.book_time_arr.length<=1,trigger:"hover"}},[e("el-table",{attrs:{data:s.book_time_arr,size:"mini",stripe:"","show-header":!1,"max-height":"180"}},[e("el-table-column",{attrs:{align:"center",width:"180"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("span",[t._v(t._s(s))])]}}],null,!0)})],1),e("div",{staticClass:"time",attrs:{slot:"reference"},slot:"reference"},[e("span",[t._v(t._s(s.book_time_arr[0]))]),e("span",{staticClass:"rht"},[s.book_time_arr.length>1?e("i",{staticClass:"el-icon-arrow-right"}):t._e()])])],1)]}}])}),e("el-table-column",{attrs:{label:t.$t("mycourse.count"),"header-align":"center",align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("span",{staticClass:"count"},[t._v("Ã—"+t._s(s.book_time_arr.length))])]}}])}),e("el-table-column",{attrs:{label:t.$t("mycourse.status"),"header-align":"center",align:"center",width:"140"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("div",{staticClass:"state",class:`status${s.status}`},[t._v(t._s(s.status_name))])]}}])}),e("el-table-column",{attrs:{label:t.$t("orderDetail.rent"),"header-align":"center",align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("div",{staticClass:"price"},[t._v("$"+t._s(s.discounts_price))])]}}])}),e("el-table-column",{attrs:{label:t.$t("jsdMyYuYueClassrooms.tenant"),"header-align":"center",align:"center"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("div",{staticClass:"studentBox"},[e("div",{staticClass:"flexLine"},[e("div",[e("img",{staticClass:"avatar",attrs:{src:s.user_avatar}}),e("div",[e("span",[t._v(t._s(s.user_name))])])]),e("contact-button",{attrs:{type:"1","target-id":s.user_id}})],1)])]}}])}),e("el-table-column",{attrs:{label:t.$t("mycourse.order_time"),"header-align":"center",align:"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("div",{staticClass:"timeOrder"},[t._v(t._s(t.$utils.formatDatetime(s.createtime)))])]}}])}),e("el-table-column",{attrs:{label:t.$t("mycourse.operate"),"header-align":"center",align:"center",width:"200"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("div",{staticClass:"btnGroup"},t._l(t.getOperate(s.op),(function(a,l){return e("el-button",{key:l,staticClass:"btn",attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(e){return t.doOperate(a.id,s)}}},[t._v(" "+t._s(a.value)+" ")])})),1)]}}])})],1),e("div",{staticClass:"fenyeCon"},[e("el-pagination",{staticClass:"fenye",attrs:{background:"",layout:"prev, pager, next","page-size":t.query.row,total:t.total},on:{"current-change":t.pageChange}})],1),t.dialogVisible?e("refund-classroom-process-dialog",{attrs:{order:t.selectItem},on:{complete:t.getList},model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}}):t._e(),t.dialogEvaluateClassroomVisible?e("evaluate-classroom-dialog",{attrs:{type:"owner",period_id:t.currentEvaluateItem.period_id},on:{complete:t.getList},model:{value:t.dialogEvaluateClassroomVisible,callback:function(e){t.dialogEvaluateClassroomVisible=e},expression:"dialogEvaluateClassroomVisible"}}):t._e(),t.forceCancelClassroomDialogVisible?e("force-cancel-classroom-dialog",{attrs:{classroom:t.forceCancelClassroom},on:{complete:t.onForceCancelComplete},model:{value:t.forceCancelClassroomDialogVisible,callback:function(e){t.forceCancelClassroomDialogVisible=e},expression:"forceCancelClassroomDialogVisible"}}):t._e()],1)},r=[],n=(s(57658),s(51206)),u=function(){var t=this,e=t._self._c;return e("el-dialog",{staticClass:"dialog",attrs:{title:t.$t("mycourse.apply_refund"),visible:t.dialogVisible,width:"400px",center:""},on:{"update:visible":function(e){t.dialogVisible=e},close:()=>t.$emit("input",!1)}},[e("div",{staticClass:"container"},[e("div",{staticClass:"content"},[e("div",{staticClass:"desc"},[t._v(t._s(t.$t("orderDetail.classroom_penalty")))]),e("div",{staticClass:"price"},[e("span",{staticClass:"label"},[t._v(t._s(t.$t("orderDetail.penalty"))+":")]),e("span",{staticClass:"value"},[t._v("$"+t._s(t.penalty))])]),e("el-button",{staticClass:"btn",attrs:{type:"primary",loading:t.submitting},on:{click:t.cancel}},[t._v(t._s(t.$t("mycourse.apply_refund")))])],1)])])},c=[],d=s(70794),m={name:"ForceCancelClassroomDialog",props:["value","classroom"],data(){return{dialogVisible:!1,submitting:!1}},created(){this.dialogVisible=this.value},watch:{value(t){this.dialogVisible=t}},computed:{penalty(){return this.classroom?(0,d.Z)(this.classroom.price).times(.1).toFixed(2):"0.00"}},methods:{async cancel(){this.submitting=!0;try{const t=await(0,n.Ik4)(this.classroom.period_id);200===t.code&&(this.$emit("complete"),this.dialogVisible=!1)}catch(t){console.error(t)}this.submitting=!1}}},_=m,h=s(1001),p=(0,h.Z)(_,u,c,!1,null,"c297e202",null),g=p.exports,C=s(61737),b=s(62371),f=function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{"close-on-click-modal":!1,title:t.$t("mycourse.process_refund_apply"),visible:t.dialogVisible,"custom-class":"box",width:"900px"},on:{"update:visible":function(e){t.dialogVisible=e},close:()=>t.$emit("input",!1)}},[e("div",{staticClass:"content"},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[t.orderData?.refund?.phone?e("div",[e("div",{staticClass:"label"},[t._v(t._s(t.$t("jsdMyYuYueClassrooms.phone")))]),e("div",{staticClass:"value"},[t._v(t._s(t.orderData.refund.phone))])]):t._e(),t.orderData?.refund?.remark?e("div",[e("div",{staticClass:"label"},[t._v(t._s(t.$t("jsdMyYuYueClassrooms.refund_reason")))]),e("div",{staticClass:"reasonText"},[t._v(t._s(t.orderData?.refund?.remark))])]):t._e(),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,size:"mini",stripe:"","max-height":"220"}},[e("el-table-column",{attrs:{prop:"date",label:t.$t("orderDetail.date"),width:"180"}}),e("el-table-column",{attrs:{prop:"time",label:t.$t("orderDetail.time"),width:"160"}}),e("el-table-column",{attrs:{prop:"discounts_price",label:t.$t("orderDetail.rent")},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v("$"+t._s(e.discounts_price))]}}])}),e("el-table-column",{attrs:{prop:"tax_price",label:t.$t("CourseCalendar.taxes")},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v("$"+t._s(e.tax_price))]}}])}),e("el-table-column",{attrs:{prop:"service_price",label:t.$t("CourseDetail.fuwufei"),width:"120"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v("$"+t._s(e.service_price))]}}])}),e("el-table-column",{attrs:{prop:"refund_price",label:t.$t("orderDetail.refund_price"),width:"120"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("b",[t._v("$"+t._s(s.refund_price))])]}}])})],1),e("div",{staticClass:"total"},[e("span",[t._v(t._s(t.$t("orderDetail.refund_total_price")))]),t._v(" "),e("b",[t._v("$"+t._s(t.totalRefund))])]),e("div",{staticClass:"label"},[t._v(t._s(t.$t("mycourse.handling_opinion")))]),e("div",{staticClass:"reason"},[e("el-input",{staticClass:"textAreaBox",attrs:{type:"textarea"},model:{value:t.reason,callback:function(e){t.reason=e},expression:"reason"}})],1),e("div",{staticClass:"dialog-footer"},[e("el-button",{attrs:{loading:t.submitting,type:"danger"},on:{click:function(e){return t.refundConfirm(!1)}}},[t._v(t._s(t.$t("mycourse.refund_deny")))]),e("el-button",{attrs:{loading:t.submitting,type:"primary"},on:{click:function(e){return t.refundConfirm(!0)}}},[t._v(t._s(t.$t("mycourse.refund_agree")))])],1)],1)])])},v=[],y={name:"RefundClassroomProcessDialog",props:["value","order"],data(){return{dialogVisible:!1,submitting:!1,reason:"",loading:!1,orderData:null,list:[]}},created(){this.dialogVisible=this.value,this.getDetail()},computed:{weekDay(){return[this.$t("CourseCalendar.xingqi1"),this.$t("CourseCalendar.xingqi2"),this.$t("CourseCalendar.xingqi3"),this.$t("CourseCalendar.xingqi4"),this.$t("CourseCalendar.xingqi5"),this.$t("CourseCalendar.xingqi6"),this.$t("CourseCalendar.xingqi7")]},totalRefund(){let t=this.list&&0!==this.list.length?this.list.reduce(((t,e)=>t.plus(e.refund_price)),new d.Z(0)):new d.Z(0);return t.toString()}},watch:{value(t){this.dialogVisible=t}},methods:{async getDetail(){this.loading=!0;try{const t=await(0,n.ohk)(this.order.out_trade_no);200===t.code&&(this.orderData=t.data,this.list=t.data?.classroom_date_time?t.data.classroom_date_time.map((t=>{let e=`${t.date} (${this.weekDay[t.week-1]})`,s=`${t.start_time} - ${t.end_time}`;return{...t,date:e,time:s}})):[])}catch(t){console.error(t)}this.loading=!1},async refundConfirm(t){this.submitting=!0;try{const e=await(0,n.xTe)(this.order.out_trade_no,this.order.period_id,t?1:2,this.reason);200===e.code&&(this.$message.success(this.$t("ShoppingCart.caozuochenggong")),this.$emit("complete"),this.dialogVisible=!1)}catch(e){console.error(e)}this.submitting=!1}}},$=y,w=(0,h.Z)($,f,v,!1,null,"96325cf0",null),Y=w.exports,k={name:"ClassroomOrderList",components:{RefundClassroomProcessDialog:Y,EvaluateClassroomDialog:b.Z,ContactButton:C.Z,ForceCancelClassroomDialog:g},props:{status:{type:Number|String,default:null}},data(){return{total:0,query:{page:1,row:10},list:[],dialogVisible:!1,reason:"",selectItem:null,currentEvaluateItem:null,loading:!1,forceCancelClassroomDialogVisible:!1,forceCancelClassroom:null,dialogEvaluateClassroomVisible:!1}},computed:{statusMapping(){return{0:this.$t("jsdMyYuYueClassrooms.status_unpaid"),1:this.$t("jsdMyYuYueClassrooms.status_paid"),5:this.$t("jsdMyYuYueClassrooms.status_in_service"),4:this.$t("jsdMyYuYueClassrooms.status_unevaluated"),3:this.$t("jsdMyYuYueClassrooms.status_evaluated"),6:this.$t("jsdMyYuYueClassrooms.status_pending_cancel"),7:this.$t("jsdMyYuYueClassrooms.status_refunded"),2:this.$t("jsdMyYuYueClassrooms.status_cancelled"),9:this.$t("jsdMyYuYueClassrooms.status_evaluated")}}},mounted(){this.getList()},methods:{async getList(){this.loading=!0,this.status&&(this.query.status=this.status);try{const t=await(0,n.j$W)(this.query);if(200===t.code){let e=t.data;this.total=e.total,this.list=e.list?.map((t=>(t.book_time_arr=t.book_time?.split(/,\s*/)||[],t)))}}catch(t){console.error(t)}this.loading=!1},jumpDetail(t){this.$router.push({path:`/classroom/order/detail/owner/${t.out_trade_no}`,query:t.period_id?{id:t.period_id}:null})},goPay(t){let e=t.classroom_id;this.$router.push({path:"/ClassRoomXiadan",query:{id:e,out_trade_no:t.out_trade_no}})},pageChange(t){this.query.page=t,this.getList()},async cancelClassroomOrder(t){try{await this.$confirm(this.$t("jsdMyYuYueClassrooms.cancel_confirm"),this.$t("jsdMyYuYueClassrooms.cancel_order"));const s=this.$loading();try{const e=await(0,n.Ovh)(t.out_trade_no);200===e.code&&(this.$message.success(this.$t("ShoppingCart.caozuochenggong")),this.getList())}catch(e){console.error(e)}s.close()}catch(e){console.error(e)}},refundRefund(t){this.selectItem=t,this.dialogVisible=!0},getOperate(t){let e=["",this.$t("jsdMyYuYueClassrooms.cancel_order"),this.$t("jsdMyYuYueClassrooms.pay_now"),this.$t("jsdMyYuYueClassrooms.apply_refund"),this.$t("jsdMyYuYueClassrooms.evaluated"),this.$t("mycourse.process_refund_apply"),""];return Object.entries(t).map((([t,s])=>({id:t,value:e[parseInt(t)]||s})))},doOperate(t,e){switch(t){case"1":this.cancelClassroomOrder(e);break;case"2":this.goPay(e);break;case"3":this.forceCancel(e);break;case"4":this.evaluateCourse(e);break;case"5":this.refundRefund(e);break;case"6":break}},forceCancel(t){this.forceCancelClassroom=t,this.forceCancelClassroomDialogVisible=!0},onForceCancelComplete(){this.$message.success(this.$t("CourseCalendar.cancel_success")),this.getList()},toClassroom(t){this.$router.push(`/ClassroomDetail?id=${t.classroom_id}`)},evaluateCourse(t){this.currentEvaluateItem=t,this.dialogEvaluateClassroomVisible=!0}}},x=k,D=(0,h.Z)(x,o,r,!1,null,"1f071f9c",null),j=D.exports,V={name:"login",components:{ClassroomOrderList:j,HomeHeader:i.Z},data(){return{currentTab:"-1"}},computed:{tabList(){return[{lable:this.$t("jsdMyYuYueClassrooms.status_all"),name:"-1"},{lable:this.$t("jsdMyYuYueClassrooms.status_unpaid"),name:"0",status:"0"},{lable:this.$t("jsdMyYuYueClassrooms.status_paid"),name:"1",status:"1"},{lable:this.$t("jsdMyYuYueClassrooms.status_unevaluated"),name:"4",status:"4"},{lable:this.$t("jsdMyYuYueClassrooms.status_evaluated"),name:"3",status:"3"},{lable:this.$t("jsdMyYuYueClassrooms.status_pending_cancel"),name:"6",status:"6"},{lable:this.$t("jsdMyYuYueClassrooms.status_refunded"),name:"7",status:"7"},{lable:this.$t("jsdMyYuYueClassrooms.status_cancelled"),name:"2",status:"2"}]}},watch:{currentTab:{handler(t){const e=window.location.href.indexOf("#"),s=-1!==e?window.location.href.slice(e):"",a=new URL(window.location.href);a.hash=s.split("?")[0]+`?tab=${t}`,window.history.pushState({path:a.toString()},"",a.toString())}}},created(){this.currentTab=this.$route.query.tab??"-1"},mounted(){},methods:{}},M=V,S=(0,h.Z)(M,a,l,!1,null,"32f86728",null),q=S.exports}}]);