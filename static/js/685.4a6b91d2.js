"use strict";(self["webpackChunkframe"]=self["webpackChunkframe"]||[]).push([[685],{9685:function(e,s,t){t.r(s),t.d(s,{default:function(){return R}});var a=function(){var e=this,s=e._self._c;return s("div",{staticClass:"container"},[s("HomeHeader",{attrs:{topimgIsShow:!1}}),s("div",{staticClass:"center"},[s("div",{staticClass:"layoutLeft"},[s("class-calendar",{ref:"weekCalendar",on:{onSelectedUpdate:e.onClassSelectedChanged}})],1),s("div",{staticClass:"layoutRight"},[s("el-tabs",{model:{value:e.currentTabName,callback:function(s){e.currentTabName=s},expression:"currentTabName"}},[s("el-tab-pane",{attrs:{label:"设置",name:"0"}},[s("courses",{attrs:{selectedClassInfo:e.selectedClassInfo},on:{onCourseDelete:e.onCourseDelete,saveSuccess:e.onCourseSaveSuccess}})],1),s("el-tab-pane",{attrs:{label:"定价",name:"1"}},[s("prices",{attrs:{selectedClassInfo:e.selectedClassInfo},on:{saveSuccess:e.onPriceSaveSuccess}})],1),s("el-tab-pane",{attrs:{label:"学生名单",name:"2"}},[s("students",{attrs:{selectedClassInfo:e.selectedClassInfo}})],1),s("el-tab-pane",{attrs:{label:"预定教室",name:"3"}},[s("classrooms",{attrs:{selectedClassInfo:e.selectedClassInfo}})],1)],1)],1)])],1)},i=[],n=t(528),l=t(1447),o=function(){var e=this,s=e._self._c;return s("div",[e._m(0),s("div",{staticClass:"priceBox"},[s("div",[e._v("每小时")]),s("div",{staticClass:"num"},[s("span",[e._v("$")]),s("el-input",{attrs:{clearable:!0},model:{value:e.price,callback:function(s){e.price=s},expression:"price"}}),s("span",[e._v("USD")])],1)]),s("div",{staticClass:"discount"},[s("div",{staticClass:"title"},[e._v("折扣")]),s("div",{staticClass:"tips"},[e._v("调整当前时间课程价格，以吸引更多学生")]),e._l(e.discountList,(function(t,a){return s("div",{key:t.id,staticClass:"item",class:e.selectedDiscount?.id===t.id?"selected":"",on:{click:function(s){return e.selected(t)}}},[s("div",[e._v(e._s(t.name))]),s("div",{staticClass:"flex"},[s("div",{staticClass:"num"},[e._v(e._s(t.discount)+"%")]),s("div",{staticClass:"tipRht"},[e._v("折扣后的价格为$"+e._s(t.price)+"USD")])])])})),s("div",{staticClass:"addBtn",on:{click:e.addDiscount}},[s("span",[e._v("添加更多折扣")]),s("i",{staticClass:"el-icon-arrow-right"})]),s("el-button",{attrs:{type:"primary",disabled:e.submitDisabled,loading:e.saving},on:{click:e.save}},[e._v("保存")])],2),s("el-dialog",{attrs:{title:"新折扣",visible:e.showNewDiscount,width:"500px"},on:{"update:visible":function(s){e.showNewDiscount=s}}},[s("div",[s("el-form",{ref:"form",attrs:{model:e.addDiscountForm,rules:e.rules,"label-width":"80px"}},[s("el-form-item",{attrs:{label:"折扣名称",prop:"name"}},[s("el-input",{model:{value:e.addDiscountForm.name,callback:function(s){e.$set(e.addDiscountForm,"name",s)},expression:"addDiscountForm.name"}})],1),s("el-form-item",{attrs:{label:"折扣比例",prop:"discount"}},[s("el-input",{model:{value:e.addDiscountForm.discount,callback:function(s){e.$set(e.addDiscountForm,"discount",s)},expression:"addDiscountForm.discount"}},[s("template",{slot:"append"},[e._v("%")])],2)],1),s("el-form-item",[s("el-button",{on:{click:function(s){e.showNewDiscount=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.onAddSubmit}},[e._v("确 定")])],1)],1)],1)])],1)},r=[function(){var e=this,s=e._self._c;return s("div",{staticClass:"flex mb20"},[s("div",[e._v("价格")]),s("div",[e._v("USD")])])}],c=t(1206),d=t(794),u={name:"Prices",props:{selectedClassInfo:{type:Object,default:()=>{}}},data(){return{addDiscountForm:{name:"",discount:""},rules:{name:[{required:!0,message:"请输入折扣名称",trigger:"blur"}],discount:[{required:!0,message:"请输入折扣比例",trigger:"blur"}]},price:"",showNewDiscount:!1,discounts:[],selectedDiscount:null,saving:!1}},watch:{selectedClass(e){1===e.length?(this.price=e[0].price,this.selectedDiscount=this.discountList.find((s=>s.id===e[0].discount_id))):(this.price="",this.selectedDiscount=null)}},computed:{submitDisabled(){return this.selectedClass.length<=0||!this.selectedDiscount||!this.price||(0,d.Z)(this.price).lte(0)},selectedClass(){return this.selectedClassInfo?.courses||[]},discountList(){return this.discounts.map((e=>({price:this.price?(0,d.Z)(this.price).multipliedBy(1-(0,d.Z)(e.discount).div(100)).decimalPlaces(2):0,...e})))}},mounted(){this.getDiscountList()},methods:{selected(e){this.selectedDiscount=e},async save(){this.saving=!0;try{let e=this.selectedClass.map((e=>e.id)).join(",");const s=await(0,c.z6)(this.selectedClassInfo.course_date_id,e,this.price,this.selectedDiscount.id);200===s.code&&(this.$message.success(this.$t("jsdCourseList.shezhichenggong")),this.$emit("saveSuccess"))}catch(e){console.error(e)}finally{this.saving=!1}},async getDiscountList(){try{const e=await(0,c.eE)();200===e.code&&(this.discounts=e.data)}catch(e){console.error(e)}},addDiscount(){this.addDiscountForm.name="",this.addDiscountForm.discount="",this.showNewDiscount=!0},async onAddSubmit(){try{await this.$refs["form"].validate();const e=await(0,c.ck)(this.addDiscountForm);200===e.code&&(this.showNewDiscount=!1,this.getDiscountList())}catch(e){console.error(e)}}}},h=u,m=t(1001),C=(0,m.Z)(h,o,r,!1,null,"6e99cea9",null),p=C.exports,g=function(){var e=this,s=e._self._c;return s("div",[s("el-select",{attrs:{editable:!1},on:{change:e.onSelectChange},model:{value:e.currentClassId,callback:function(s){e.currentClassId=s},expression:"currentClassId"}},e._l(e.classList,(function(t,a){return s("el-option",{key:`${t.id}`,attrs:{label:`${e.weekDay[parseInt(t.week)-1]} ${t.date.replaceAll("-","/")} ${t.start_time}-${t.end_time}`,value:t.id}})})),1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.querying,expression:"querying"}],staticStyle:{width:"100%"},attrs:{data:e.studentList}},[s("el-table-column",{attrs:{label:"头像",width:"50"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("img",{staticClass:"avatar",attrs:{src:e.row.avatar}})]}}])}),s("el-table-column",{attrs:{prop:"username",label:"姓名",width:"80"}}),s("el-table-column",{attrs:{label:"课程时间"},scopedSlots:e._u([{key:"default",fn:function({row:{date:t,start_time:a,end_time:i}}){return[s("span",[e._v(e._s(t)+" "+e._s(a)+"-"+e._s(i))])]}}])}),s("el-table-column",{attrs:{label:"操作",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-popconfirm",{attrs:{title:"确定取消该课程么？"},on:{confirm:function(s){return e.cancel(t.row)}}},[s("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[e._v("取消")])],1)]}}])})],1),s("el-pagination",{attrs:{background:"","current-page":e.page,"page-size":e.pageSize,"pager-count":5,layout:"prev, pager, next",total:e.total},on:{"current-change":e.onPageChange,"update:currentPage":function(s){e.page=s},"update:current-page":function(s){e.page=s}}})],1)},v=[],_={name:"Students",props:{selectedClassInfo:{type:Object,default:()=>{}}},data(){return{studentList:[],total:0,pageSize:10,page:1,id:"",currentClassId:"",classList:[],querying:!1}},computed:{selectedClass(){return this.selectedClassInfo?.courses||[]},weekDay(){return[this.$t("CourseCalendar.xingqi1"),this.$t("CourseCalendar.xingqi2"),this.$t("CourseCalendar.xingqi3"),this.$t("CourseCalendar.xingqi4"),this.$t("CourseCalendar.xingqi5"),this.$t("CourseCalendar.xingqi6"),this.$t("CourseCalendar.xingqi7")]}},watch:{selectedClass(e){this.studentList=[],this.total=0,this.currentClassId="",this.classList=[],e&&e.length&&(this.getStudents(1),this.getClassList())}},mounted(){this.id=this.$route.query.id},methods:{async getClassList(){try{this.currentClassId="",this.classList=[];let e=this.selectedClass.map((e=>e.id)).join(",");const s=await(0,c.yZ)(e);200===s.code&&(this.classList=s.data),console.log(s)}catch(e){console.error(e)}},async getStudents(e){console.log(e),this.querying=!0;try{this.studentList=[],this.total=0;let s=this.selectedClass.map((e=>e.id)).join(",");const t=await(0,c.mr)(s,this.currentClassId,e,this.pageSize);200===t.code&&(this.studentList=t.data?.list,this.total=t.data?.total,this.page=e)}catch(s){console.error(s)}this.querying=!1},onPageChange(e){this.getStudents(e)},onSelectChange(e){this.getStudents(1)},async cancel(e){try{const s=await(0,c.gC)(e.id);200===s.code&&(this.$message.success(this.$t("CourseCalendar.cancel_success")),this.getStudents(1))}catch(s){console.error(s)}}}},f=_,b=(0,m.Z)(f,g,v,!1,null,"3c619bfe",null),y=b.exports,k=function(){var e=this,s=e._self._c;return s("div",[s("el-select",{attrs:{editable:!1},on:{change:e.onSelectChange},model:{value:e.currentClassId,callback:function(s){e.currentClassId=s},expression:"currentClassId"}},e._l(e.classList,(function(t,a){return s("el-option",{key:`${t.id}`,attrs:{label:`${e.weekDay[parseInt(t.week)-1]} ${t.date.replaceAll("-","/")} ${t.start_time}-${t.end_time}`,value:t.id}})})),1),s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.querying,expression:"querying"}],staticClass:"result-box"},e._l(e.classroomList,(function(t){return s("div",{staticClass:"lineBox"},[s("div",{staticClass:"liBox"},[s("img",{staticClass:"imgBox",attrs:{src:t.images[0]??""}}),s("div",{staticClass:"right"},[s("div",{staticClass:"titleTop"},[e._v(e._s(t.name))]),s("div",[e._v(e._s(t.brief))])])]),s("div",[s("div",[e._v(e._s(t.address))]),s("div",{staticClass:"btnRht"},[s("el-button",{attrs:{type:"text"}},[e._v("预定")])],1)])])})),0)],1)},w=[],x={name:"Classrooms",props:{selectedClassInfo:{type:Object,default:()=>{}}},data(){return{classroomList:[],currentClassId:"",classList:[],querying:!1}},computed:{selectedClass(){return this.selectedClassInfo?.courses||[]},weekDay(){return[this.$t("CourseCalendar.xingqi1"),this.$t("CourseCalendar.xingqi2"),this.$t("CourseCalendar.xingqi3"),this.$t("CourseCalendar.xingqi4"),this.$t("CourseCalendar.xingqi5"),this.$t("CourseCalendar.xingqi6"),this.$t("CourseCalendar.xingqi7")]}},watch:{selectedClass(e){this.classroomList=[],this.currentClassId="",this.classList=[],e&&e.length&&(this.getClassList(),this.getClassRooms())}},methods:{async getClassList(){try{this.currentClassId="",this.classList=[];let e=this.selectedClass.map((e=>e.id)).join(",");const s=await(0,c.yZ)(e);200===s.code&&(this.classList=s.data),console.log(s)}catch(e){console.error(e)}},async getClassRooms(){this.querying=!0;try{this.classroomList=[];let e=this.selectedClass.map((e=>e.id)).join(",");const s=await(0,c.$Y)(e,this.currentClassId,1,9999);200===s.code&&(this.classroomList=s.data.map((e=>({...e,images:e.images.split(",")}))))}catch(e){console.error(e)}this.querying=!1},onSelectChange(e){this.getClassRooms()}}},$=x,D=(0,m.Z)($,k,w,!1,null,"282b61e0",null),I=D.exports,S=function(){var e=this,s=e._self._c;return s("div",[s("dl",[s("dt",[e._v("上课时间")]),e._l(e.selectedClass,(function(t,a){return s("dd",{key:Math.random(),staticClass:"flexLine"},[s("div",[e._v(e._s(`${e.weekDay[parseInt(t.week)-1]} ${t.start_time} - ${t.end_time}`))]),s("div",{staticClass:"flex"},[s("div",{staticClass:"time"},[e._v(e._s(e.formatTimeLong(t.start_time,t.end_time)))]),s("el-popconfirm",{attrs:{title:"确定移除该课节么？"},on:{confirm:function(s){return e.remove(t.id)}}},[s("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[e._v("移除")])],1)],1)])}))],2),s("dl",[s("dt",[e._v("上课人数")]),s("dd",[s("el-input",{attrs:{clearable:!0},model:{value:e.book_num,callback:function(s){e.book_num=s},expression:"book_num"}})],1)]),s("dl",[e._m(0),s("dd",[s("el-input",{attrs:{clearable:!0},model:{value:e.book_min_num,callback:function(s){e.book_min_num=s},expression:"book_min_num"}})],1)]),s("dl",[s("dt",[e._v("上课地点")]),s("dd",[s("el-input",{attrs:{type:"textarea",clearable:!0,autosize:{minRows:2,maxRows:4}},model:{value:e.address,callback:function(s){e.address=s},expression:"address"}})],1)]),s("el-button",{attrs:{type:"primary",disabled:e.submitDisabled,loading:e.saving},on:{click:e.save}},[e._v("保存")])],1)},q=[function(){var e=this,s=e._self._c;return s("dt",[e._v("最低开课人数 "),s("span",{staticClass:"tips"},[e._v("(未达标课节自动取消)")])])}],L={name:"Courses",props:{selectedClassInfo:{type:Object,default:()=>{}}},data(){return{book_num:"",book_min_num:"",address:"",saving:!1}},watch:{selectedClass(e){1===e.length?(this.book_num=e[0].book_num,this.book_min_num=e[0].book_min_num,this.address=e[0].address):(this.book_num="",this.book_min_num="",this.address="")}},computed:{submitDisabled(){return this.selectedClass.length<=0||!this.book_num||!this.book_min_num||!this.address},selectedClass(){return this.selectedClassInfo?.courses||[]},weekDay(){return[this.$t("CourseCalendar.xingqi1"),this.$t("CourseCalendar.xingqi2"),this.$t("CourseCalendar.xingqi3"),this.$t("CourseCalendar.xingqi4"),this.$t("CourseCalendar.xingqi5"),this.$t("CourseCalendar.xingqi6"),this.$t("CourseCalendar.xingqi7")]}},methods:{async save(){try{this.saving=!0;let e=this.selectedClass.map((e=>e.id)).join(",");const s=await(0,c.uz)(this.selectedClassInfo.course_date_id,e,this.address,this.book_num,this.book_min_num);200===s.code&&(this.$message.success(this.$t("jsdCourseList.shezhichenggong")),this.$emit("saveSuccess"))}catch(e){console.error(e)}finally{this.saving=!1}},formatTimeLong(e,s){let t=e.split(":"),a=s.split(":"),i=60*parseInt(a[0])+parseInt(a[1])-(60*parseInt(t[0])+parseInt(t[1]));return this.$t("CourseCalendar.time_long_pattern",[i])},async remove(e){console.log(e);try{this.$emit("onCourseDelete",e)}catch(s){console.log()}}}},j=L,N=(0,m.Z)(j,S,q,!1,null,"95033b84",null),Z=N.exports,z={name:"headercom",components:{Courses:Z,Classrooms:I,Students:y,Prices:p,ClassCalendar:l.Z,HomeHeader:n.Z},data(){return{selectedClassInfo:null,currentTabName:0}},watch:{},created(){},methods:{onClassSelectedChanged(e){console.log(e),this.selectedClassInfo=e},onCourseDelete(e){this.$refs.weekCalendar.unselectClassById(e)},onPriceSaveSuccess(){this.$refs.weekCalendar.queryCourses()},onCourseSaveSuccess(){this.$refs.weekCalendar.queryCourses()}}},F=z,P=(0,m.Z)(F,a,i,!1,null,"080bf301",null),R=P.exports}}]);